#!/usr/bin/env bash

# Script to open a directory in a new tmux window
# Usage: tmux-window [directory]

# Process arguments
if [[ $# -ge 1 ]]; then
    selected=$1
else
    selected=$(find ~/.config ~/code ~/fun ~/personal ~/work ~/research -mindepth 0 -maxdepth 5 -type d | fzf)
fi

# Exit if no directory was selected
if [[ -z $selected ]]; then
    exit 0
fi

# Check if we're in a tmux session
if [[ -z $TMUX ]]; then
    echo "Error: Not in a tmux session"
    echo "Please start or attach to a tmux session first"
    exit 1
fi

# Find the highest window number in the current session
latest_window=$(tmux list-windows -F "#{window_index}" | sort -n | tail -n 1)

# Create a new window after the latest window and open the selected directory
tmux new-window -a -t "$latest_window" -c "$selected"